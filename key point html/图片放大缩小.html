<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title></title>
	</head>
	<body>
		<img id="imga" src="./123.jpg" width="100" height="100" />
		<HR>
		<button type="button">convert</button>
		<img id="imgb"/>
		<HR>
		<script stype="text/javascript;">
			let button = document.querySelector('button');

			button.onclick = function () {
				compress(500).then((val) => {
					// 最后的事件处理程序
					imgb.src = val;
				});
			}
		 
			function compress(targetWidth) {
				// 获取元素和设置变量
				var newImage = document.querySelector('#imga'),
					canvas = document.createElement("canvas"),
					ctx = canvas.getContext("2d"),
					imgWidth,
					imgHeight,
				// 应用逻辑
				return new Promise((resolve) => {
					// 进行简单的数据交换
					imgWidth = newImage.width;
					imgHeight = newImage.height;
					// 根据条件进行计算
					if (imgWidth > imgHeight) {
						canvas.width = targetWidth;
						canvas.height = targetWidth * imgHeight / imgWidth;
					} else {
						canvas.height = targetWidth;
						canvas.width = targetWidth * imgWidth / imgHeight;
					}
					// 绘制画布
					ctx.drawImage(newImage, 0, 0, canvas.width, canvas.width);
					// 得到画布base64格式的数据
					var base64 = canvas.toDataURL('image/png', 1);
					// 返回数据
					resolve(base64)
				});
			}
		</script>
	</body>
</html>
